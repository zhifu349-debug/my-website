# 🚀 部署清单 - 从零到上线

## 📋 准备阶段（可提前完成）

### ✅ 第1部分：准备工作
- [ ] 阅读部署文档
- [ ] 确定部署平台（CloudBase/EdgeOne/Lighthouse/其他）
- [ ] 注册部署平台账号
- [ ] 准备域名（如果没有）
- [ ] 准备支付方式（如需付费）

### ✅ 第2部分：环境配置
- [ ] 复制 `.env.local` 模板（如有）
- [ ] 配置环境变量：
  - [ ] `NEXT_PUBLIC_SITE_URL` = https://your-domain.com
  - [ ] `DATABASE_URL` = 数据库连接字符串（如使用）
  - [ ] 其他需要的变量

---

## 🎯 部署阶段

### 方案A：使用CloudBase（推荐）

#### 步骤1：登录CloudBase
1. 访问 https://cloudbase.net
2. 登录或注册腾讯云账号
3. 进入"云开发"控制台

#### 步骤2：创建环境
1. 点击"新建环境"
2. 选择环境类型（默认即可）
3. 输入环境名称（如：cms-prod）
4. 等待创建完成（约1-2分钟）

#### 步骤3：初始化项目
1. 点击"静态网站托管"
2. 选择"新建"或"导入"
3. 如果新建，输入项目信息

#### 步骤4：配置域名
1. 进入"域名管理"
2. 添加自定义域名
3. 按提示配置DNS记录
4. 等待DNS生效（通常10分钟-24小时）

#### 步骤5：上传代码
```bash
# 方法1：通过控制台上传（推荐）
- 打包项目：`npm run build`
- 上传 `out` 或 `.next` 目录

# 方法2：使用CLI（高级用户）
npm install -g @cloudbase/cli
cb login
cb deploy hosting
```

#### 步骤6：配置数据库（可选但推荐）
1. 进入"数据库"
2. 创建集合：`contents`, `media`, `categories`, `tags`
3. 获取数据库连接字符串
4. 修改代码中的 `content-store.ts` 使用真实数据库

---

### 方案B：使用EdgeOne Pages

#### 步骤1：登录EdgeOne
1. 访问腾讯云控制台
2. 进入"EdgeOne"
3. 点击"站点列表"

#### 步骤2：创建站点
1. 点击"新建站点"
2. 选择"静态网站"
3. 配置基本信息

#### 步骤3：连接代码仓库（推荐）
1. 连接GitHub/Gitee
2. 选择项目仓库
3. 配置构建命令：
   - 构建命令：`npm run build`
   - 输出目录：`.next`
4. 自动部署

#### 步骤4：配置域名
1. 进入站点设置
2. 添加域名
3. 配置DNS

---

### 方案C：使用Lighthouse

#### 步骤1：创建实例
1. 进入腾讯云Lighthouse控制台
2. 创建新实例
3. 选择配置（建议：2核4G）

#### 步骤2：登录服务器
1. 获取服务器IP和密码
2. SSH登录：
   ```bash
   ssh root@your-server-ip
   ```

#### 步骤3：安装Node.js
```bash
# 安装Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 验证安装
node -v
```

#### 步骤4：上传代码
```bash
# 安装PM2（进程管理）
npm install -g pm2

# 克隆或上传代码
git clone your-repo-url /var/www/cms
cd /var/www/cms

# 安装依赖
npm install

# 构建项目
npm run build

# 使用PM2启动
pm2 start npm --name "cms" -- start
pm2 save
pm2 startup
```

#### 步骤5：配置Nginx
```bash
# 安装Nginx
sudo apt-get install -y nginx

# 配置站点
sudo nano /etc/nginx/sites-available/cms
```

Nginx配置示例：
```nginx
server {
    listen 80;
    server_name your-domain.com;

    root /var/www/cms/.next;
    index index.html;

    location / {
        try_files $uri $uri/ index.html;
    }
}
```

```bash
# 启用站点
sudo ln -s /etc/nginx/sites-available/cms /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

---

## ✅ 部署后检查清单

### 第1天：基础验证
- [ ] 测试首页能否访问
- [ ] 测试所有页面路由（27个）
- [ ] 测试中英文切换
- [ ] 测试移动端访问
- [ ] 检查页面加载速度

### 第2天：功能验证
- [ ] 测试CMS管理后台
- [ ] 测试上传图片功能
- [ ] 测试创建和发布文章
- [ ] 测试所有表单提交
- [ ] 检查所有链接是否正确

### 第3天：SEO验证
- [ ] 检查robots.txt可访问
- [ ] 检查sitemap.xml可访问
- [ ] 验证页面meta标签
- [ ] 验证Schema.org数据
- [ ] 提交到Google Search Console

### 第1周：数据分析
- [ ] 安装Google Analytics
- [ ] 配置事件追踪
- [ ] 测试数据收集
- [ ] 设置转化目标

---

## 🔧 常见问题排查

### 问题1：页面404
**可能原因**：
- 静态导出路径不对
- Nginx配置错误

**解决方法**：
```bash
# 检查构建输出
ls -la .next

# 检查Nginx配置
sudo nginx -t
sudo systemctl restart nginx
```

### 问题2：CSS/JS加载失败
**可能原因**：
- 路径配置错误
- 文件权限问题

**解决方法**：
```bash
# 修正文件权限
sudo chown -R www-data:www-data /var/www/cms
sudo chmod -R 755 /var/www/cms
```

### 问题3：API 404/500错误
**可能原因**：
- API路由未正确部署
- 环境变量未配置

**解决方法**：
- 检查 `.next/server/app/api` 目录是否存在
- 验证环境变量是否加载
- 查看服务器日志

### 问题4：语言切换不工作
**可能原因**：
- Middleware未生效
- Cookies未正确设置

**解决方法**：
- 确认 `middleware.ts` 在项目根目录
- 清除浏览器cookies
- 检查网络请求headers

### 问题5：图片上传失败
**可能原因**：
- 文件大小超过限制
- 文件类型不支持
- 目录权限问题

**解决方法**：
```bash
# 确保uploads目录可写
sudo mkdir -p /var/www/cms/public/uploads
sudo chown -R www-data:www-data /var/www/cms/public/uploads
sudo chmod 777 /var/www/cms/public/uploads
```

---

## 📊 性能优化建议

### 1. 图片优化
- 使用WebP格式（比JPG小30%）
- 压缩图片（使用TinyPNG等工具）
- 懒加载非首屏图片
- 使用CDN加速

### 2. 代码优化
- 启用Gzip/Brotli压缩
- 配置浏览器缓存
- 减少HTTP请求数
- 使用HTTP/2

### 3. 缓存策略
```nginx
# Nginx缓存配置
location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

---

## 🔐 安全加固建议

### 1. HTTPS配置
```bash
# 使用Let's Encrypt免费证书
sudo apt-get install -y certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

### 2. 防火墙配置
```bash
# UFW防火墙
sudo ufw allow 22/tcp   # SSH
sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 443/tcp  # HTTPS
sudo ufw enable
```

### 3. 管理后台保护
- 添加身份验证
- 限制访问IP（可选）
- 使用HTTPS强制重定向

---

## 📞 部署支持

### 获取帮助
1. 查看文档：`上线前检查报告.md`
2. 查看手册：`小白使用指南.md`
3. 平台文档：
   - CloudBase: https://cloudbase.net/docs
   - EdgeOne: https://cloud.tencent.com/product/edgeone
   - Lighthouse: https://cloud.tencent.com/product/lighthouse

### 日志查看
```bash
# PM2日志
pm2 logs cms

# Nginx日志
tail -f /var/log/nginx/error.log
tail -f /var/log/nginx/access.log
```

---

## ✨ 部署成功后的第一件事

1. **立即做**
   - [ ] 上传第一篇测试文章
   - [ ] 验证文章显示正常
   - [ ] 分享链接到社交媒体测试

2. **一周内完成**
   - [ ] 创建至少5篇文章
   - [ ] 配置Google Analytics
   - [ ] 提交搜索引擎
   - [ ] 添加Favicon（如有）

3. **一个月内完成**
   - [ ] 连接真实数据库
   - [ ] 添加更多内容（20+文章）
   - [ ] 优化SEO关键词
   - [ ] 分析访问数据并优化

---

## 🎉 恭喜！

当你完成这个清单时，你的网站就成功上线了！

**祝你访问量暴涨，收入翻倍！** 🚀
